<!-- JS Dependencies -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" crossorigin="anonymous"
  defer></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" crossorigin="anonymous"
  defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.7/ScrollMagic.min.js" defer></script>



<script defer>

  function setCookie(cname,cvalue,exdays) {
    var d = new Date();
    d.setTime(d.getTime() + (exdays*24*60*60*1000));
    var expires = "expires=" + d.toGMTString();
    document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
  }

  function getCookie(cname) {
    var name = cname + "=";
    var decodedCookie = decodeURIComponent(document.cookie);
    var ca = decodedCookie.split(';');
    for(var i = 0; i < ca.length; i++) {
      var c = ca[i];
      while (c.charAt(0) == ' ') {
        c = c.substring(1);
      }
      if (c.indexOf(name) == 0) {
        return c.substring(name.length, c.length);
      }
    }
    return "";
  }

  function checkCookie() {
    getCookie("show-client-modal")
  }

  setCookie("show-client-modal", true, 1);

  console.log(checkCookie())
  

  $(document).ready(function(){
    //launch onboarding modal on page load
    $('#modal-onboarding').modal('show')
    var controller = new ScrollMagic.Controller();

    $('[data-lazy-type]').each(function () {
      var currentElement = this;
      var $this = $(this);
      var type = $this.data('lazy-type');
      var lazySrc = $this.data('lazy-src');
      var scene = new ScrollMagic.Scene({
        triggerElement: currentElement,
        reverse: false,
        offset: -500
      })
        .on('enter', function () {
          if (type == 'image') {
            $this.attr('src', lazySrc);
          }
          if (type == 'bg-image') {
            $this.css('background-image', 'url(' + lazySrc + ')')
          }
          if (type == 'video') {
            $this.attr('src', lazySrc);
          }
          if (type == 'bg-video') {
            lazyLoadBgVideo($this);
          }
        })
        .on('exit', function () {
          if (type == 'bg-video') {
            // test to confirm this is working
            currentElement.pause();
          }
        })
        .setClassToggle(currentElement, "active")
        .addTo(controller);
    })

    var hash = window.location.hash;
    console.log(hash)
    if(hash && $('.nav-tabs').length){
      // var active_tab = $('.nav-tabs a').attr('href', hash);
      $('.nav-tabs a[href="' + hash + '"]').tab('show');
    }

    $('.nav-tabs a').click(function (e) {
      console.log('tab click')
      hash = $(this).attr('href');
      console.log(hash)
      window.location.hash = hash;
    });


    //Show slide number in onboarding carousel
    var totalSlides = $('#carousel-onboarding .carousel-item').length -1;
    console.log(totalSlides)
    var currentIndex = $('.carousel-item.active').index();
    if(currentIndex == 0){
      $('.carousel-controls').removeClass('controls-active');
    }else {
      $('.carousel-controls').addClass('controls-active');
    }

    console.log(currentIndex)

    $('#carousel-onboarding').bind('slid.bs.carousel', function() {
      currentIndex = $('#carousel-onboarding .carousel-item.active').index();
      if(currentIndex == 0){
        $('#carousel-onboarding .carousel-controls').removeClass('controls-active');
      }else {
        $('#carousel-onboarding .carousel-controls').addClass('controls-active');
      }
    $('.slide-number').html(''+currentIndex+' of '+totalSlides+'');
    });

    //replace onboarding image on collapse click

    $('[data-video]').on('click', function(){
      if($(this).hasClass('collapsed')) {
        console.log('do it')
        var new_video = $(this).data('video')
        var instruction_video = $('.carousel-item.active').find('.instruction-video')
        console.log(new_video)
        instruction_video.attr('src', new_video);
      }else {
        var instruction_video = $('.carousel-item.active').find('.instruction-video')
        var default_video = instruction_video.data('default-video');
        console.log('hiding')
        instruction_video.attr('src', default_video)
      }
    })

    function autoPlayYouTubeModal(){
      var trigger = $("body").find('[data-toggle="modal"]');
      trigger.click(function() {
        var theModal = $(this).data( "target" ),
        videoSRC = $(this).attr( "data-theVideo" ), 
        videoSRCauto = videoSRC+"?autoplay=1" ;
        $(theModal+' iframe').attr('src', videoSRCauto);
        $(theModal+' button.close').click(function () {
            $(theModal+' iframe').attr('src', videoSRC);
        });   
      });
    }

    autoPlayYouTubeModal();
  })
</script>